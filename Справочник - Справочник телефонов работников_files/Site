$.fn.setCursorPosition=function(n){return this.each(function(t,i){if(i.setSelectionRange)i.setSelectionRange(n,n);else if(i.createTextRange){var r=i.createTextRange();r.collapse(!0);r.moveEnd("character",n);r.moveStart("character",n);r.select()}}),this};$(document).ready(function(){function f(n){$(n).find(".PhoneWork").each(function(){(/^\d\d-\d\d$/.test($(this).val())||$(this).val()==="")&&$(this).mask("99-99")});$(n).find(".PhoneCity,.PhoneHome").each(function(){(/^\d\d\d-\d\d-\d\d$/.test($(this).val())||$(this).val()==="")&&$(this).mask("999-99-99")});$(n).find(".PhoneMobile").each(function(){(/^\+375-\d\d-\d\d\d-\d\d-\d\d$/.test($(this).val())||$(this).val()==="")&&$(this).mask("+375-99-999-99-99")});$(n).find(".PhoneWork,.PhoneCity,.PhoneHome,.PhoneMobile").on("focus",function(){$(this).setCursorPosition(0)})}function n(n){$(n).find("[title]").filter(function(){return $(this).attr("title")!==undefined&&$(this).attr("title")!==""}).addClass("HasTitle")}function s(){var t=$(this).prev();return $.ajax({url:this.href,cache:!1,type:"get",success:function(i){var r=$(i).hide();f($(r));n($(r));t.append($(r)).children(":last").toggle("slow");$(r).find(".PhoneWork,.PhoneCity,.PhoneHome,.PhoneMobile").focus()}}),!1}function h(){var t=$(this).prev();return $.ajax({url:this.href,cache:!1,type:"get",success:function(i){var r=$(i).hide();n($(r));t.append($(r).hide()).children(":last").toggle("slow");e(t.children(":last"))}}),!1}function c(){$("#Holiday_rows").parent().parent().toggle("slow")}function si(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(i){var r=new Image;r.addEventListener("load",function(){(r.width>500||r.height>500)&&alert("Разрешение изображение должно быть 500px*500px");var t="Разрешение изображение "+r.width+"px*"+r.height+"px";$(n).parent().siblings(".ImagePreLoad").attr("src",i.target.result).attr("data-original-title",t).addClass("HasTitle")});r.src=t.result};t.readAsDataURL(n.files[0])}}function hi(){var n=$(this);n.parent().siblings("#PhotoNew").removeAttr("value");n.siblings(".ImageLoad").val("");n.parent().siblings(".ImagePreLoad").removeAttr("src")}var o,k,i,oi,r,u,e,l,nt,a,v,it,y,rt,ut,p,w,ft,b,et,ot,st;if($("#ReportDate").datetimepicker({locale:"ru",format:"DD.MM.YYYY",defaultDate:new Date,maxDate:new Date,useCurrent:!0}),o=function(){var t=$(this),n=t.parents(".DateRange").find(".DateTimePicker"),i;n.length===2&&(i=t.data("DateTimePicker").date(),t.is(n.eq(0))?n.eq(1).data("DateTimePicker").minDate(i):n.eq(0).data("DateTimePicker").maxDate(i))},k=function(n){var t=$(n).find(".DateRange .DateTimePicker");t.datetimepicker({locale:"ru",format:"DD.MM.YYYY HH:mm:ss",defaultDate:new Date,useCurrent:!1});t.on("dp.change",o);t.each(o)},k($("body")),$("#table_head").is("#table_head")){var ht=$("#id1"),ct=$("#id2"),lt=$("#id3"),at=$("#id4"),vt=$("#id5"),yt=$("#id6"),pt=$("#id7"),wt=$("#id8"),bt=$("#id9"),kt=$("#head_id_1"),dt=$("#head_id_2"),gt=$("#head_id_3"),ni=$("#head_id_4"),ti=$("#head_id_5"),ii=$("#head_id_6"),ri=$("#head_id_7"),ui=$("#head_id_8"),fi=$("#head_id_9"),d=$(".RStickyElement"),g=$("#table_head"),ei=$(".table");i=function(){d.css("left",g.position().left-$(window).scrollLeft());d.innerWidth(ei.innerWidth());ht.innerWidth(kt.innerWidth());ct.innerWidth(dt.innerWidth());lt.innerWidth(gt.innerWidth());at.innerWidth(ni.innerWidth());vt.innerWidth(ti.innerWidth());yt.innerWidth(ii.innerWidth());pt.innerWidth(ri.innerWidth());wt.innerWidth(ui.innerWidth());bt.innerWidth(fi.innerWidth())};oi=g.offset().top;r=function(){var n=$(window).scrollTop()+50;i!==undefined&&i()};r();$(window).scroll(function(){r()});$(window).resize(function(){r()})}u=function(){$(".popup").fadeOut(800);setTimeout(function(){$(".popup").remove();$("body").removeAttr("style");i!==undefined&&i()},800)};$("body").on("click",".container .image,.container-fluid .image",function(){$("body").css("overflow","hidden");i!==undefined&&i();var n=$(this),t=n.attr("src");$("body").append("<div class='popup' id='popup'><div class='close'/><div class='popup_bg'/><img src='"+t+"' class='popup_img' oncontextmenu='return false;'/><\/div>");$("#popup").animate({opacity:"show"},800);$("html").on("keydown",function(){(event.Escape||event.keyCode===27)&&($("html").off("keydown"),u())});$(".popup_bg").click(function(){u()});$(".popup .popup_img").click(function(){u()})}).on("focus",".PhoneWork,.PhoneCity,.PhoneHome,.PhoneMobile",function(){$(this).setCursorPosition(0)}).on("click",".DeleteRow",function(){$(this).parent().parent().parent().parent().parent().toggle("slow",function(){$(this).remove()});$(".tooltip.fade.bottom.in").remove()}).on("click",".DeleteMask",function(){var n=$(this).parent().parent().children("input");$(n).unmask()});f($("body"));n($("body"));$("body").tooltip({selector:".HasTitle",delay:{show:500,hide:100},container:"body",placement:function(n,t){return $(t).position().top<=100?"bottom":"top"}});$(".AddRow").on("click",s);e=function(n){$(n).find(".DatePickers").datepicker({format:"yyyy-mm-dd",todayBtn:"linked",language:"ru"})};e($("body"));$("#HolidayAdd").on("click",h);$("#HasHoliday").on("click",c);$(window).scroll(function(){$(this).scrollTop()>90?$(".ScrollUp").fadeIn():$(".ScrollUp").fadeOut()});$(".ScrollUp").click(function(){return $("html, body").animate({scrollTop:0},900),!1});$(".popup").hover(function(){$(this).find(".close").animate({opacity:1},100)},function(){$(this).find(".close").animate({opacity:0},100)});$("#MainMenu ul li").hover(function(){$("#MainMenu ul li > ul").removeAttr("style")},function(){});$("#MainMenu").on("click","a",function(n){n.preventDefault();var t=$(this).attr("href"),i=$(t).offset().top-115;$("#MainMenu ul li > ul").css({visibility:"hidden",opacity:0});$("body,html").animate({scrollTop:i},900)});$("body").on("change",".ImageLoad",function(){si(this)});$("body").on("click",".ImageDelete",hi);$("#btnPrint").on("click",function(){window.print()});$(".roll").on("click",function(){$(this).parent().next(".ui-sortable").toggle("slow");$(this).toggleClass("glyphicon-chevron-down").toggleClass("glyphicon-chevron-up");$(this).attr("data-original-title",$(this).attr("data-original-title")==="Свернуть"?"Развернуть":"Свернуть")});$(".roll").parent().next().toggle("slow");$(".roll").toggleClass("glyphicon-chevron-down").toggleClass("glyphicon-chevron-up");$(".roll").attr("title","Развернуть");l=function(n){var t=0;$(n).children(".ui-sortable").children().each(function(){$(this).attr("order",t);t=t+1;l(this)})};nt=function(){var n=0;$("[groupLvl=0]").each(function(){$(this).attr("order",n);n=n+1;l(this)})};$("#SubmitList").click(function(){nt();var n=[];$(".ui-sortable").each(function(){$.each($(this).sortable("toArray"),function(){var t=$("#"+this),i={Key:t.attr("id"),Value:Number(t.attr("order"))};n.push(i)})});$.ajax({url:"/Groups/SortedLists",type:"post",data:{items:n},success:function(){alert("Сохранено")}})});$("#sortable,#sortable ul").sortable({placeholder:"ui-state-highlight",axis:"y",sort:function(n,t){$(t.item).width($(".ui-sortable-placeholder").innerWidth()+2);$(".ui-sortable-placeholder").innerHeight($(t.item).innerHeight()-2)}});$("#sortable").disableSelection();var t='<div class="modal fade in" tabindex="-1" id="modal_form" role="dialog" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><\/span><\/button><h4 class="modal-title">New message<\/h4><\/div><div class="modal-body"><\/div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Отменить<\/button><button type="button" class="btn btn-primary btn-save">Сохранить<\/button><\/div><\/div><\/div><\/div>',ci='<div class="text_general_information">    <p>Ведомственная сеть связи Минского метрополитена предназначена для ведения служебных переговоров внутри сети, а так же с абонентами сети связи общего пользования (ГТС).<\/p>    <p>Нумерация телефонов внутри сети связи метрополитена четырехзначная.<\/p>    <p>Для вызова абонента сети связи метрополитена абонентом ГТС необходимо к четырехзначному номеру телефона добавить:        <ul>            <li>к номерам телефонов метрополитена, начинающихся с цифр 2, 5, 6, комбинацию цифр - 219<\/li>            <li>к номерам телефонов метрополитена, начинающихся с цифры 8, 9, комбинацию цифр - 383<\/li>        <\/ul>    <\/p>    <p><b>Пример:<\/b>        <ol>            <li>Номер телефона абонента сети связи метрополитена 61-12. Вызов его абонентом ГТС осуществляется набором: 219-61-12<\/li>            <li>Номер телефона абонента сети связи метрополитена 84-24. Вызов его абонентом ГТС осуществляется набором: 383-84-24<\/li>        <\/ol>    <\/p>    <p>Для вызова абонентом сети связи метрополитена абонента ГТС необходимо перед номером телефона абонента ГТС добавить индекс «3»    <\/p>    <p><b>Пример:<\/b> Номер телефона абонента ГТС 240-83-42. Вызов его абонентом сети связи метрополитена, осуществляется набором: 3-240-83-42.<\/p>    <p>Для выхода абонента сети связи метрополитена на международную или междугородную телефонную сеть необходимо после набора вышеуказанных индексов дальнейший набор производить в соответствии с Правилами МГТС, являющимися общими для всех сетей связи и обуславливающими порядок набора абонентов этих сетей.<\/p>    <p><b>Пример:<\/b> Для номеров телефонов выход на международную и междугородную телефонную сеть осуществляется набором: 38 + код страны, код зоны, № телефона вызываемого абонента.<\/p><\/div>',li=function(n){var t=0;n.each(function(){$(this).attr("order",t);t=t+1})},tt=function(){var n,i;$(".tooltip.fade.bottom.in").remove();n=$(t);n.find(".modal-title").text($(this).data("original-title"));i=$(this).parent().attr("id").replace("group_id","");$.ajax({url:"/Home/GetPartialSortableList",data:{groupId:i},cache:!1,success:function(t){var r=$("<table>").addClass("table").append($("<tbody>").append(t));r.find("td.NotPrint").css("display","none");r.find("th.NotPrint").remove();r.find("tr.ForPrint").removeClass("ForPrint");n.find(".modal-body").append(r);n.find(".modal-dialog").css("min-width","700px");r.sortable({placeholder:"ui-state-highlight",axis:"y",items:".SortList-"+i,sort:function(n,t){$(t.item).width($(".ui-sortable-placeholder").innerWidth()+2);$(".ui-sortable-placeholder").innerHeight($(t.item).innerHeight()-2)}});r.disableSelection();n.modal("show");n.find(".btn-save").one("click",function(){var t=$(".modal .SortList-"+i),r;li(t);r=[];t.each(function(){var n={Key:$(this).attr("id"),Value:Number($(this).attr("order"))};r.push(n)});$.ajax({url:"/Home/SortedLists",type:"post",data:{items:r},success:function(){alert("Сохранено");$(".container .SortList-"+i).replaceWith(function(n){var i=t.eq(n).clone().removeClass("ui-sortable-handle").removeAttr("order");return i.find("td.NotPrint").removeAttr("style"),i})}});n.modal("hide")});n.one("hidden.bs.modal",function(){$(this).remove();$("body").one("click",".bnt-sortable",tt)})}})};$("body").one("click",".bnt-sortable",tt);a=function(){$(".tooltip.fade.bottom.in").remove();var u=$(this),i=$(t),r=$(u).parent().parent().parent().attr("id");$.ajax({url:"/Home/EditPartial",cache:!1,data:{id:r},success:function(t){i.find(".modal-body").append(t);i.find(".modal-title").text($(u).data("original-title"));i.find(".modal-dialog").css("min-width","700px");f(i);n(i);e(i);i.modal("show");i.find(".AddRow").on("click",s);i.find("#HolidayAdd").on("click",h);i.find("#HasHoliday").on("click",c);i.one("hidden.bs.modal",function(){$(this).remove();$("body").one("click",".EditPeople",a)});i.find(".btn-save").one("click",function(){var t=new FormData(document.querySelector(".modal-body form"));t.append("image",i.find(".ImageLoad").eq(0).get(0).files[0]);$.ajax({url:"/Home/Edit",type:"post",data:t,contentType:!1,processData:!1,success:function(t){$("#"+r).replaceWith(t);n($("#"+r))}});i.modal("hide")})}})};$("body").one("click",".EditPeople",a);v=function(){$(".tooltip.fade.bottom.in").remove();var r=$(this),i=$(t),u=$(r).parent().parent().parent().attr("id");$.ajax({url:"/Home/Delete",cache:!1,data:{id:u},success:function(t){i.find(".modal-body").append(t);i.find(".btn-save").text("Удалить");i.find(".modal-title").text($(r).data("original-title"));i.find(".modal-dialog").css("min-width","700px");n(i);i.modal("show");i.one("hidden.bs.modal",function(){$(this).remove();$("body").one("click",".DeletePeople",v)});i.find(".btn-save").one("click",function(){var n=new FormData(document.querySelector(".modal-body form"));$.ajax({url:"/Home/Delete",type:"post",data:n,contentType:!1,processData:!1,success:function(){$("#"+u).toggle("slow",function(){$(this).remove()})}});i.modal("hide")})}})};$("body").one("click",".DeletePeople",v);it=$(window).height()/2;$(window).resize(function(){it=$(window).height()/2});y=function(){$(".tooltip.fade.bottom.in").remove();var r=$(this),i=$(t);$.ajax({url:"/Home/Create",cache:!1,success:function(t){i.find(".modal-body").append(t);i.find(".modal-title").text($(r).data("original-title"));i.find(".modal-dialog").css("min-width","700px");f(i);n(i);i.modal("show");i.find(".AddRow").on("click",s);i.find("#HolidayAdd").on("click",h);i.find("#HasHoliday").on("click",c);i.one("hidden.bs.modal",function(){$(this).remove();$("body").one("click","#AddPeople",y)});i.find(".btn-save").one("click",function(){var t=new FormData(document.querySelector(".modal-body form"));t.append("image",i.find(".ImageLoad").eq(0).get(0).files[0]);$.ajax({url:"/Home/Create",type:"post",data:t,contentType:!1,processData:!1,success:function(t){var r=$(t).attr("id"),i=$(t).attr("class"),u=i.replace("SortList-","group_id");$("."+i).length===0?$("#"+u).removeClass("hide NotPrint").parent().parent().after(t):$("."+i+":last").after(t);n($("#"+r));$("html").animate({scrollTop:$("#"+r).offset().top-$(window).height()/2},250)}});i.modal("hide")})}})};$("body").one("click","#AddPeople",y);rt=function(){var n=$(this);n.prop("checked")?n.siblings("ul").find("[type=checkbox]").prop("checked",!0).prop("indeterminate",!1):n.siblings("ul").find("[type=checkbox]").prop("checked",!1).prop("indeterminate",!1);n.parent().parent().siblings("[type=checkbox]").trigger("change")};ut=function(){var n=$(this),i=0,r=0,t=n.siblings("ul").find("[type=checkbox]");t.each(function(){var n=$(this);n.prop("checked")?i++:r++});t.length===i?(n.prop("checked",!0),n.prop("indeterminate",!1)):t.length===r?(n.prop("checked",!1),n.prop("indeterminate",!1)):n.prop("indeterminate",!0);n.parent().parent().siblings("[type=checkbox]").trigger("change")};$(".checkbox_tree [type=checkbox]").on("click",rt).on("change",ut);$("#result_tree").on("click",function(){var n=0;$(".checkbox_tree [type=checkbox]:checked").each(function(){n|=$(this).attr("code")});alert(n)});p=function(){$(".tooltip.fade.bottom.in").remove();var i=$(t);i.find(".modal-body").append(ci);i.find(".btn-secondary").text("Ok");i.find(".btn-save").remove();i.find(".modal-title").text("Общие сведения");i.find(".modal-dialog").css("min-width","700px");n(i);i.modal("show");i.one("hidden.bs.modal",function(){$(this).remove();$("body").one("click",".TextGeneralInformation2",p)})};$("body").one("click",".TextGeneralInformation2",p);w=function(){$(".tooltip.fade.bottom.in").remove();var i=$(t);i.find(".modal-body").append('<img src="/Content/Info.png" style="max-width: 100%;">');i.find(".btn-secondary").text("Ok");i.find(".btn-save").remove();i.find(".modal-title").text("Цветовая индексая справочника");i.find(".modal-dialog").css("min-width","700px");n(i);i.modal("show");i.one("hidden.bs.modal",function(){$(this).remove();$("body").one("click",".TextGeneralInformation1",w)})};$("body").one("click",".TextGeneralInformation1",w);ft=function(){var n=$(t);n.find(".modal-title").text("ВНИМАНИЕ!!!Функционал ограничен!");n.find(".modal-body").append('<p>Для снятия ограничения необходимо предоставить учетные данные:<br><\/p><ul style="margin-left: 20px;"><li>Фамилия Имя Отчество<\/li><li>Должность<\/li><li>Рабочая почта(если есть)<\/li><li>Рабочий телефон<\/li><li>Служба/отдел/подразделение<\/li><li>Помещение<\/li><\/ul>Учетные данные оформить в виде .doc документа, в названии документа указать ФИО<br>К документу приложить фото разрешение не менее 1000х1000 пикселей.<br>Документ с фото разместить в Q:АСУиНТКОНТАКТЫ<br>По оставшимся вопросам звоните тел.56-52<p><\/p>');n.find(".btn-secondary").text("Ok");n.find(".btn-save").remove();n.modal("show")};$("body").on("click change",".FunctionBlackList",ft);$("body .FunctionBlackList").trigger("change");b=function(){var i=$("#DateTimePickerStart.DateTimePicker").data("DateTimePicker").date().toJSON(),r=$("#DateTimePickerEnd.DateTimePicker").data("DateTimePicker").date().toJSON(),t=$("#RequestList");t.empty();t.append($("<img>",{src:".\\Content\\loading.gif"}));$.ajax({url:"/Request/GetRequestForDate",type:"get",data:{Start:i,End:r},success:function(i){t.empty();var r=$(i);n(r);t.append(r)}})};$("body").on("dp.change","#DateTimePickerStart.DateTimePicker, #DateTimePickerEnd.DateTimePicker",b);$("#DateTimePickerStart.DateTimePicker").trigger("dp.change");$("body").on("click",".RequestsUpdate",b);et=function(){$(".tooltip.fade.bottom.in").remove();var i=$(t);i.find(".modal-title").text("Новая заявка");i.one("hidden.bs.modal",function(){$(this).remove()});$.ajax({url:"/request/Create",type:"get",success:function(t){i.find(".modal-body").append(t);n(i);i.modal("show");i.find(".btn-save").one("click",function(){var n=new FormData(document.querySelector(".modal-body form"));$.ajax({url:"/Request/Create",type:"post",data:n,contentType:!1,processData:!1,success:function(){var n=new Date;n.setHours(24,0,0,0);$("#DateTimePickerEnd.DateTimePicker").data("DateTimePicker").date(n);$("#DateTimePickerEnd.DateTimePicker").trigger("dp.change")},failure:function(n){alert(n.responseText)},error:function(n){alert(n.responseText)}});i.modal("hide")})}})};$("body").on("click","#CreateRequest",et);ot=function(){$(".tooltip.fade.bottom.in").remove();var i=$(t);i.find(".modal-title").text("Профиль");i.one("hidden.bs.modal",function(){$(this).remove()});$.ajax({url:"/Account/UserProfileEdit",type:"get",success:function(t){i.find(".modal-body").append(t).focus();i.find(".modal-body input").eq(1).focus();n(i);i.modal("show");i.find(".btn-save").on("click",function(){var n=new FormData(document.querySelector(".modal-body form"));$.ajax({url:"/Account/UserProfileEdit",type:"post",data:n,contentType:!1,processData:!1,success:function(n){n!==""?i.find(".modal-body").empty().append(n):($.ajax({url:"/Account/UserProfileView",type:"get",success:function(n){$("#Profile").empty().append(n)}}),i.modal("hide"),$.ajax({url:"/Account/GetUserHello",type:"get",success:function(n){$(".UserHello").empty().append(n)}}))},failure:function(n){i.modal("hide");alert(n.responseText)},error:function(n){i.modal("hide");alert(n.responseText)}})})}})};$("body").on("click","#EditUserProfile",ot);st=function(){var n,i;$(".tooltip.fade.bottom.in").remove();n=$(t);n.find(".modal-title").text("Отменить заявку");n.one("hidden.bs.modal",function(){$(this).remove()});i=$(this).closest("tr").find("#Id").val();n.find(".btn-save").text("Да");n.modal("show");n.find(".btn-save").on("click",function(){$.ajax({url:"/Request/SetRequestCancel",type:"post",data:{id:i},success:function(){}})})};$("body").on("click",".RequestCancel",st)})