jQuery.browser={};jQuery.browser.opera=/opera/.test(navigator.userAgent.toLowerCase());jQuery.browser.safari=/safari/.test(navigator.userAgent.toLowerCase());jQuery.browser.msie=/msie/.test(navigator.userAgent.toLowerCase());$(document).ready(function(){$(window).on("load",function(){init_search()})});var init_search=function(){(!$.browser.msie||$.browser.version>6)&&ClassSearch()},ClassSearch=function(){var tt=2,it=800,rt=300,ut=10,p="",n=$("#search_field"),h="мгновенный поиск",c="search_block search_block_active",ft="search_block",et=$("#search_text"),e=$(".next"),o=$(".previous"),u=$(".results_count"),w=null,t=null,f=null,i=null,s=null,l=null,r=[],a=!0,b=function(){this.iTotalResults=0;for(u.parent().css("display","none"),t&&t.children("ins").hasClass("active")&&t.children("ins").removeClass("active");$results=r.pop();)$results.html($results.html().replace(/<\/?ins.*?>/ig,""));r=[];a=!0;yt();y();f&&(f.remove(),f=null);t=null;p=""},ot=function(){if($clear_value=n.val().replace(/[^А-я0-9ё\w\s]/ig,""),$clear_value.length!=0||a||b(),$clear_value==p||$clear_value.length<tt||$clear_value==h)return!1;p=$clear_value;a||b();f=$("<div>").addClass("infoscroller_container");$("body").append(f);f.height($(window).height()-50);$(window).on("resize",function(){f!=null&&f.height($(window).height()-50)});if(i=null,s&&(clearTimeout(s),s=null),l=0,$regex=new RegExp("("+$clear_value.replace(new RegExp("(.)","ig"),"$1\\-?")+")","ig"),$count=k(et["0"].childNodes,$regex,0),$count<=0)return b(),u.parent().css("display","block"),u.text("не найдено"),!1;u.text("1 из "+$count);u.parent().css("display","block");d($regex);pt();v()},v=function(f){if(i===null||i+2>r.length?i=0:i++,t&&t.children("ins").hasClass("active")&&t.children("ins").removeClass("active"),f){$top=f.offset().top;for(var e=0;e<r.length;e++)if(r[e].offset().top>=$top){i=e;break}}t=r[i];t.children("ins").addClass("active");$("html").animate({scrollTop:t.offset().top-155},250);u.text(u.text().replace(/\d+ (из \d+)/,i+1+" $1"));i<=0?y():nt();n.focus()},st=function(){if(i)i--;else return y(),!1;t&&t.children("ins").hasClass("active")&&t.children("ins").removeClass("active");t=r[i];t.children("ins").addClass("active");$("html").animate({scrollTop:t.offset().top-155},250);u.text(u.text().replace(/\d+ (из \d+)/,i+1+" $1"));i<=0?y():nt()},k=function(n,t,i){for(var u=0;u<n.length;u++){if(n[u].nodeName=="#text"){$condition=t.test(n[u].nodeValue);$condition&&$(n[u]).parent().css("display")!="none"&&$(n[u]).parent().css("visibility")!="hidden"&&(r.push($(n[u]).parent()),i++);continue}n[u].nodeName!="STYLE"&&(i=k(n[u].childNodes,t,i))}return i},d=function(n){$count=0;for(var t=l;t<r.length;t++)if($count++,l=t+1,r[t].html(r[t].html().replace(n,"<ins id='ref"+t+"'>$1<\/ins>")),ht(r[t],t),$count>=ut)break;s=l<r.length-1?setTimeout(function(){d(n)},rt):null;a=!1},ht=function(n,t){$marker=$("<a>");$marker.attr("href","/#ef"+t).attr("top",n.offset().top).on("click",function(){v(n)}).css("top",n.offset().top/$(document).outerHeight(!0)*100+"%");f.append($marker)},ct=function(){n.val()==h&&(n.val(""),u.parent().css("display","none"));n.parent().parent().addClass(c)},lt=function(){n.focus().select()},g=function(){n.val()==""||n.val()==h?(n.val(h),n.parent().parent().removeClass(c),n.parent().parent().addClass(ft),u.parent().css("display","none")):n.parent().parent().addClass(c)},at=function(){n.parent().parent().addClass(c)},vt=function(n){var i=this;if(w&&clearTimeout(w),n||(n=$(window.event)),n.keyCode==13&&t)return v(),!1;w=setTimeout(function(){ot()},it)},yt=function(){e.removeClass("next_active");e.off("click")},y=function(){o.removeClass("previous_active");o.off("click")},pt=function(){if(!e.hasClass("next_active")){e.addClass("next_active");e.on("click",function(){v()})}},nt=function(){if(!o.hasClass("previous_active")){o.addClass("previous_active");o.on("click",function(){return st()})}};n.val()==""&&g();n.on("focus",function(){ct()}).on("click",function(){lt()}).on("blur",function(){g()}).on("keydown",function(){at()}).on("keyup",function(n){vt(n)});n.val()=="";n.trigger("focus")}